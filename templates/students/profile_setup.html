{% extends 'students/layout_students.html' %}

{% block title %}Profile Setup - Student Dashboard{% endblock %}

{% block extra_css %}
<style>
    .location-dropdown {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        color: white;
        padding: 12px 16px;
    }

    .location-dropdown:focus {
        outline: none;
        border-color: #06b6d4;
        box-shadow: 0 0 0 2px rgba(6, 182, 212, 0.2);
    }

    .location-dropdown option {
        background: #1e293b;
        color: white;
        padding: 8px;
    }

    .profile-picture-preview {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid rgba(6, 182, 212, 0.3);
    }

    .upload-button {
        background: rgba(6, 182, 212, 0.2);
        border: 1px solid #06b6d4;
        color: #06b6d4;
        padding: 8px 16px;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .upload-button:hover {
        background: rgba(6, 182, 212, 0.3);
    }
</style>
{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 relative overflow-hidden p-4 sm:p-6 lg:p-8">
    <!-- Background Effects -->
    <div class="absolute inset-0 bg-[url('data:image/svg+xml,%3Csvg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"%3E%3Cg fill="none" fill-rule="evenodd"%3E%3Cg fill="%236366f1" fill-opacity="0.1"%3E%3Ccircle cx="30" cy="30" r="1.5"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E')] opacity-20"></div>

    <div class="relative z-10 max-w-4xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white mb-4">
                Profile Setup
            </h1>
            <p class="text-xl text-gray-300">
                Configure your boarding preferences and profile information
            </p>
        </div>

        <!-- Profile Form -->
        <div class="glass-card rounded-3xl p-8 border border-white/10">
            <form method="post" enctype="multipart/form-data" class="space-y-8">
                {% csrf_token %}

                <!-- Profile Picture Section -->
                <div class="text-center space-y-4">
                    <h2 class="text-2xl font-semibold text-white mb-4">Profile Picture</h2>

                    <div class="flex flex-col items-center space-y-4">
                        <div class="relative">
                            {% if profile_picture_url %}
                                <img src="{{ profile_picture_url }}" alt="Profile Picture" class="profile-picture-preview" id="profile-preview">
                            {% else %}
                                <div class="profile-picture-preview bg-gradient-to-br from-cyan-400/20 to-purple-400/20 border-2 border-cyan-400/30 flex items-center justify-center" id="profile-preview">
                                    <svg class="w-12 h-12 text-cyan-400" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                                    </svg>
                                </div>
                            {% endif %}
                        </div>

                        <div class="flex items-center space-x-4">
                            <input type="file"
                                   name="profile_picture"
                                   id="profile_picture"
                                   accept="image/*"
                                   class="hidden">
                            <label for="profile_picture" class="upload-button">
                                Choose Photo
                            </label>
                            <span class="text-sm text-gray-400">
                                Max size: 5MB (JPG, PNG)
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Contact Information -->
                <div class="space-y-6">
                    <h2 class="text-2xl font-semibold text-white mb-4">Contact Information</h2>

                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">
                            Phone Number
                        </label>
                        <input type="tel"
                               name="phone"
                               value="{{ profile.phone|default:'' }}"
                               class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-400 focus:outline-none focus:border-cyan-400 focus:ring-2 focus:ring-cyan-400/20"
                               placeholder="e.g., +63 912 345 6789">
                    </div>
                </div>

                <!-- Boarding Preferences -->
                <div class="space-y-6">
                    <h2 class="text-2xl font-semibold text-white mb-4">Boarding Location Preferences</h2>
                    <p class="text-sm text-gray-400 mb-4">
                        Set your preferred location for boarding houses. Only Caraga Region is currently supported.
                    </p>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Region -->
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">
                                Preferred Region <span class="text-red-400">*</span>
                            </label>
                            <select name="boarding_region"
                                    id="boarding_region"
                                    class="location-dropdown w-full"
                                    required>
                                <option value="">Select Region</option>
                                <option value="Caraga (Region XIII)" {% if profile.boarding_region == "Caraga (Region XIII)" %}selected{% endif %}>
                                    Caraga (Region XIII)
                                </option>
                            </select>
                        </div>

                        <!-- Province -->
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">
                                Preferred Province
                            </label>
                            <select name="boarding_province"
                                    id="boarding_province"
                                    class="location-dropdown w-full">
                                <option value="">Select Province</option>
                            </select>
                        </div>

                        <!-- City/Municipality -->
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">
                                Preferred City/Municipality
                            </label>
                            <select name="boarding_city"
                                    id="boarding_city"
                                    class="location-dropdown w-full">
                                <option value="">Select City/Municipality</option>
                            </select>
                        </div>

                        <!-- Barangay -->
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">
                                Preferred Barangay
                            </label>
                            <select name="boarding_barangay"
                                    id="boarding_barangay"
                                    class="location-dropdown w-full">
                                <option value="">Select Barangay</option>
                            </select>
                        </div>
                    </div>

                    <!-- Address -->
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">
                            Specific Address Preferences (Optional)
                        </label>
                        <textarea name="boarding_address"
                                  rows="3"
                                  class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-400 focus:outline-none focus:border-cyan-400 focus:ring-2 focus:ring-cyan-400/20"
                                  placeholder="e.g., Near university, quiet area, accessible by public transport...">{{ profile.boarding_address|default:'' }}</textarea>
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="flex justify-end space-x-4 pt-6">
                    <a href="{% url 'students:student_dashboard' %}"
                       class="px-6 py-3 rounded-xl border border-white/20 text-white font-medium hover:bg-white/10 transition">
                        Cancel
                    </a>
                    <button type="submit"
                            class="px-8 py-3 bg-gradient-to-r from-cyan-500 to-blue-600 text-white font-semibold rounded-xl hover:from-cyan-600 hover:to-blue-700 transition">
                        Save Profile
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
// Location data for Caraga Region only
const locationData = {
    "Caraga (Region XIII)": {
        "Agusan del Norte": {
            "Butuan City": ["Anticala", "Baan", "Bancasi", "Banza", "Baranggay 1", "Baranggay 2", "Baranggay 3"],
            "Nasipit": ["Cahayagan", "Taguibo", "Poblacion"],
            "Las Nieves": ["Poblacion", "San Roque", "Santo Rosario"],
            "Magallanes": ["Poblacion", "Tagbuyawan", "Magsaysay"]
        },
        "Agusan del Sur": {
            "Prosperidad": ["Poblacion", "San Teodoro", "Villa Mercedes"],
            "San Francisco": ["Poblacion", "Alegria", "Ebro"],
            "Trento": ["Poblacion", "Mat-i", "Mahagsay"],
            "Bunawan": ["Poblacion", "Consuelo", "Libertad"]
        },
        "Surigao del Norte": {
            "Surigao City": ["Canlanipa", "Ipil", "Mabua", "Poblacion 1", "Poblacion 2", "Poblacion 3"],
            "Alegria": ["Poblacion", "Budlingin", "Magsaysay"],
            "Placer": ["Poblacion", "Esperanza", "Ipil"],
            "Dapa": ["Poblacion", "Caub", "San Isidro"]
        },
        "Surigao del Sur": {
            "Tandag City": ["Poblacion", "Bongtud", "Telaje", "Awasian"],
            "Bislig City": ["Poblacion", "Mangagoy", "San Fernando", "San Vicente"],
            "Adlay": ["Poblacion", "Kasapa1an", "Upper Ulian"],
            "Bayabas": ["Poblacion", "Mahayahay", "New Tubigon"]
        },
        "Dinagat Islands": {
            "San Jose": ["Poblacion", "Santa Cruz", "Aurelio"],
            "Basilisa": ["Poblacion", "Santa Rita", "Benglen"],
            "Cagdianao": ["Poblacion", "Villa Real", "New Mainit"],
            "Dinagat": ["Poblacion", "San Juan", "Ecija"]
        }
    }
};

// Profile picture preview
document.getElementById('profile_picture').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const preview = document.getElementById('profile-preview');
            preview.innerHTML = `<img src="${e.target.result}" alt="Profile Preview" class="profile-picture-preview">`;
        };
        reader.readAsDataURL(file);
    }
});

// Location dropdowns
const regionSelect = document.getElementById('boarding_region');
const provinceSelect = document.getElementById('boarding_province');
const citySelect = document.getElementById('boarding_city');
const barangaySelect = document.getElementById('boarding_barangay');

// Current values
const currentProvince = "{{ profile.boarding_province|default:'' }}";
const currentCity = "{{ profile.boarding_city|default:'' }}";
const currentBarangay = "{{ profile.boarding_barangay|default:'' }}";

// Populate provinces when region changes
regionSelect.addEventListener('change', function() {
    const selectedRegion = this.value;
    populateProvinces(selectedRegion);
    clearSelections(['city', 'barangay']);
});

provinceSelect.addEventListener('change', function() {
    const selectedRegion = regionSelect.value;
    const selectedProvince = this.value;
    populateCities(selectedRegion, selectedProvince);
    clearSelections(['barangay']);
});

citySelect.addEventListener('change', function() {
    const selectedRegion = regionSelect.value;
    const selectedProvince = provinceSelect.value;
    const selectedCity = this.value;
    populateBarangays(selectedRegion, selectedProvince, selectedCity);
});

function populateProvinces(region) {
    provinceSelect.innerHTML = '<option value="">Select Province</option>';
    if (region && locationData[region]) {
        Object.keys(locationData[region]).forEach(province => {
            const option = document.createElement('option');
            option.value = province;
            option.textContent = province;
            if (province === currentProvince) option.selected = true;
            provinceSelect.appendChild(option);
        });
    }
}

function populateCities(region, province) {
    citySelect.innerHTML = '<option value="">Select City/Municipality</option>';
    if (region && province && locationData[region] && locationData[region][province]) {
        Object.keys(locationData[region][province]).forEach(city => {
            const option = document.createElement('option');
            option.value = city;
            option.textContent = city;
            if (city === currentCity) option.selected = true;
            citySelect.appendChild(option);
        });
    }
}

function populateBarangays(region, province, city) {
    barangaySelect.innerHTML = '<option value="">Select Barangay</option>';
    if (region && province && city && locationData[region] && locationData[region][province] && locationData[region][province][city]) {
        locationData[region][province][city].forEach(barangay => {
            const option = document.createElement('option');
            option.value = barangay;
            option.textContent = barangay;
            if (barangay === currentBarangay) option.selected = true;
            barangaySelect.appendChild(option);
        });
    }
}

function clearSelections(types) {
    types.forEach(type => {
        if (type === 'province') {
            provinceSelect.innerHTML = '<option value="">Select Province</option>';
        } else if (type === 'city') {
            citySelect.innerHTML = '<option value="">Select City/Municipality</option>';
        } else if (type === 'barangay') {
            barangaySelect.innerHTML = '<option value="">Select Barangay</option>';
        }
    });
}

// Initialize on page load
if (regionSelect.value) {
    populateProvinces(regionSelect.value);
    if (currentProvince) {
        setTimeout(() => {
            provinceSelect.value = currentProvince;
            populateCities(regionSelect.value, currentProvince);
            if (currentCity) {
                setTimeout(() => {
                    citySelect.value = currentCity;
                    populateBarangays(regionSelect.value, currentProvince, currentCity);
                    if (currentBarangay) {
                        setTimeout(() => {
                            barangaySelect.value = currentBarangay;
                        }, 100);
                    }
                }, 100);
            }
        }, 100);
    }
}
</script>
{% endblock %}
