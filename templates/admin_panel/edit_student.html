{% extends 'base.html' %}

{% block title %}Edit Student - Boarding Hub{% endblock %}

{% block header_title %}Safety Management Panel{% endblock %}
{% block current_view_title %}Edit Student{% endblock %}

{% block sidebar %}
{% include 'admin_panel/_sidebar.html' %}
{% endblock %}

{% block back_button %}
<a href="{% url 'admin_panel:students' %}" class="mb-4 text-xs text-gray-500 hover:text-indigo-600 transition duration-200 flex items-center space-x-1 group inline-block">
    <i class="fas fa-arrow-left text-xs"></i>
    <span>Back to Students</span>
</a>
{% endblock %}

{% block content %}
<div class="flex justify-center">
    <div class="w-full max-w-3xl">
        <header class="mb-8 text-center">
            <h2 class="text-4xl font-bold text-gray-900">Edit Student</h2>
            <p class="text-gray-500 mt-1">Update student information and academic details.</p>
        </header>

        <div class="bg-white p-6 rounded-2xl shadow-lg">
    <form method="post" action="{% url 'admin_panel:edit_student' student.id %}">
        {% csrf_token %}
        
        <div class="space-y-6">
            <!-- Basic Information -->
            <div>
                <h3 class="text-xl font-semibold text-gray-800 mb-4 border-b pb-2">Basic Information</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="student_id" class="block text-sm font-medium text-gray-700 mb-1">Student ID *</label>
                        <input type="text" id="student_id" name="student_id" value="{{ student.student_id }}" required
                               class="w-full p-3 border border-gray-300 rounded-xl focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    
                    <div>
                        <label for="year_level" class="block text-sm font-medium text-gray-700 mb-1">Year Level</label>
                        <input type="text" id="year_level" name="year_level" value="{{ student.year_level }}"
                               class="w-full p-3 border border-gray-300 rounded-xl focus:ring-indigo-500 focus:border-indigo-500"
                               placeholder="e.g., 1st Year">
                    </div>
                    
                    <div>
                        <label for="first_name" class="block text-sm font-medium text-gray-700 mb-1">First Name *</label>
                        <input type="text" id="first_name" name="first_name" value="{{ student.user.first_name }}" required
                               class="w-full p-3 border border-gray-300 rounded-xl focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    
                    <div>
                        <label for="last_name" class="block text-sm font-medium text-gray-700 mb-1">Last Name *</label>
                        <input type="text" id="last_name" name="last_name" value="{{ student.user.last_name }}" required
                               class="w-full p-3 border border-gray-300 rounded-xl focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    
                    <div>
                        <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email *</label>
                        <input type="email" id="email" name="email" value="{{ student.user.email }}" required
                               class="w-full p-3 border border-gray-300 rounded-xl focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    
                    <div>
                        <label for="date_of_birth" class="block text-sm font-medium text-gray-700 mb-1">Date of Birth</label>
                        <input type="date" id="date_of_birth" name="date_of_birth" 
                               value="{% if student.date_of_birth %}{{ student.date_of_birth|date:'Y-m-d' }}{% endif %}"
                               class="w-full p-3 border border-gray-300 rounded-xl focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                </div>
            </div>
            
            <!-- Academic Information -->
            <div>
                <h3 class="text-xl font-semibold text-gray-800 mb-4 border-b pb-2">Academic Information</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="department" class="block text-sm font-medium text-gray-700 mb-1">Department</label>
                        <select id="department" name="department" 
                                class="w-full p-3 border border-gray-300 rounded-xl focus:ring-indigo-500 focus:border-indigo-500">
                            <option value="">Select Department</option>
                            {% for dept in departments %}
                            <option value="{{ dept.id }}" {% if student.department and student.department.id == dept.id %}selected{% endif %}>{{ dept.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div>
                        <label for="program" class="block text-sm font-medium text-gray-700 mb-1">Program</label>
                        <select id="program" name="program" 
                                class="w-full p-3 border border-gray-300 rounded-xl focus:ring-indigo-500 focus:border-indigo-500">
                            <option value="">Select Program</option>
                            {% for prog in programs %}
                            <option value="{{ prog.id }}" 
                                    data-department="{{ prog.department.id }}"
                                    {% if student.program and student.program.id == prog.id %}selected{% endif %}>
                                {{ prog.name }} ({{ prog.department.name }})
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- Emergency Contact -->
            <div>
                <h3 class="text-xl font-semibold text-gray-800 mb-4 border-b pb-2">Emergency Contact</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="emergency_contact_name" class="block text-sm font-medium text-gray-700 mb-1">Contact Name</label>
                        <input type="text" id="emergency_contact_name" name="emergency_contact_name" 
                               value="{{ student.emergency_contact_name }}"
                               class="w-full p-3 border border-gray-300 rounded-xl focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    
                    <div>
                        <label for="emergency_contact_phone" class="block text-sm font-medium text-gray-700 mb-1">Contact Phone</label>
                        <input type="text" id="emergency_contact_phone" name="emergency_contact_phone" 
                               value="{{ student.emergency_contact_phone }}"
                               class="w-full p-3 border border-gray-300 rounded-xl focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                </div>
            </div>
            
            <!-- Actions -->
            <div class="flex space-x-4 pt-4 border-t">
                <button type="submit" class="flex-1 p-3 bg-indigo-600 text-white font-semibold rounded-xl hover:bg-indigo-700 transition">
                    <i class="fas fa-save mr-2"></i> Save Changes
                </button>
                <a href="{% url 'admin_panel:students' %}" class="flex-1 p-3 bg-gray-200 text-gray-700 font-semibold rounded-xl hover:bg-gray-300 transition text-center">
                    <i class="fas fa-times mr-2"></i> Cancel
                </a>
            </div>
        </div>
    </form>
    </div>
</div>

<script>
// Filter programs based on selected department
document.getElementById('department').addEventListener('change', function() {
    const selectedDept = this.value;
    const programSelect = document.getElementById('program');
    const options = programSelect.querySelectorAll('option');
    
    options.forEach(option => {
        if (option.value === '') {
            option.style.display = 'block';
        } else {
            const deptId = option.getAttribute('data-department');
            if (deptId === selectedDept || !selectedDept) {
                option.style.display = 'block';
            } else {
                option.style.display = 'none';
            }
        }
    });
    
    // Reset program selection if it doesn't match the department
    if (selectedDept && programSelect.value) {
        const selectedOption = programSelect.options[programSelect.selectedIndex];
        if (selectedOption.getAttribute('data-department') !== selectedDept) {
            programSelect.value = '';
        }
    }
});
</script>
{% endblock %}

